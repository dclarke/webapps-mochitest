<html>
  <body>
    This page contains javascript that can be included in an iframe and
    upon recieving commands over jschannel will attempt to invoke privileged
    repository management APIs.
  </body>
  <!-- jschannel, that's how our parent will control us -->
  <script src="../jschannel.js"></script>
  <script src="../jshelper.js"></script>
  <!-- finally, define our handlers that'll be invoked over jschannel by the parent -->
  <script>
    var chan = Channel.build({
      window: window.parent,
      origin: "*",
      scope: "test",
      onReady: function() {alert("iframe ready");},
      debugOutput: true
    });

   chan.bind("getSelf", function(trans) {
      trans.delayReturn(true);
      alert("getSelf called");
      console.log("HERE in getSelf function");
      var pending = navigator.mozApps.getSelf();
      pending.onsuccess = function () {
               console.log(this.result.manifest.name);
               trans.complete(
               subsetOf(this.result,
                  ['installOrigin','installTime','manifest',
                 'manifestURL','origin','receipts'])
               );
      };
      pending.onerror = function () {trans.error(this.error);};
   });

  </script>


</html>
