<html>
  <head>
  here in the head, load iframe please</head>
  <body>
  </body>
  <script src="../jschannel.js"></script>
  <script>
    var iframe = document.createElement("iframe");
    iframe.setAttribute('type', 'content');
    iframe.setAttribute('src', "http://sub2.test1.example.org:80/chrome/dom/tests/mochitest/webapps/apps/include.html");
    iframe.setAttribute('style', "width: 350px; height: 350px; display: block;");
    iframe.setAttribute('id', "iframeId");
    iframe.height = window.innerHeight + 'px';
    iframe.width = window.innerWidth + 'px';
    document.body.appendChild(iframe);
    window.parent.postMessage("message","*");
    var chan = Channel.build({
      window: document.getElementById("iframeId").contentWindow,
      scope: "test",
      origin: "*",
      debugOutput: true,
      onReady: function() {alert("parent ready");
         chan.call({method: "getSelf", success: function(result) {
            mozAppscb(result,
            { status: "== \"success\"",
              installOrigin: "== " + "chrome://mochitests".quote(),
              origin: "== " + "*".quote(),
              manifestURL: "== " + appURL.quote()
            },
            next);
         }});
      }
     });
  </script>
</html>
